import{j as e,o as U,m as i,b as k,I as V,J as W,K as Y,t as q,d as z}from"./ui-vendor-SHwgMfjD.js";import{h as B,u as F,r}from"./react-vendor-CM6QddGd.js";import{u as G,a as Q}from"./api.service-Bdqm0VAB.js";import{e as X,c as Z,A as ee,f as ae}from"./index-8zYlZnql.js";function le(){const{sourceCode:h,vodId:f}=B(),A=F(),{videoAPIs:b}=X(),{playback:C}=Z(),[s,D]=r.useState(null),[L,w]=r.useState(!0),[d,M]=r.useState(C.defaultEpisodeOrder==="desc"),[x,I]=r.useState(""),[_,N]=r.useState(null),[u,R]=r.useState(100);r.useEffect(()=>{const a=()=>{const t=window.innerWidth;let n=2,l=8;t>=1024?(n=8,l=5):t>=768?(n=6,l=6):t>=640&&(n=3,l=8),R(n*l)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),G(s?.videoInfo?.title||"视频详情");const m=()=>s?.videoInfo?.title||"",E=()=>s?.videoInfo?.cover||"https://via.placeholder.com/300x400?text=暂无封面",P=()=>s?.videoInfo?.type||"",S=()=>s?.videoInfo?.year||"",g=()=>s?.videoInfo?.director||"",v=()=>s?.videoInfo?.actor||"",$=()=>s?.videoInfo?.area||"",j=()=>s?.videoInfo?.desc||"",T=()=>s?.videoInfo?.source_name||"",y=r.useMemo(()=>{const a=s?.videoInfo?.episodes_names?.length||0;if(a===0)return[];const t=[];if(d)for(let n=0;n<a;n+=u){const l=n,o=Math.min(n+u-1,a-1),c=a-l,p=a-o;t.push({label:`${c}-${p}`,value:`${l}-${o}`,start:l,end:o})}else for(let n=0;n<a;n+=u){const l=n,o=Math.min(n+u-1,a-1);t.push({label:`${l+1}-${o+1}`,value:`${l}-${o}`,start:l,end:o})}return t},[s?.videoInfo?.episodes_names?.length,u,d]),O=r.useMemo(()=>{if(!x||!s?.videoInfo?.episodes_names)return[];const[a,t]=x.split("-").map(Number),n=s.videoInfo.episodes_names.length,l=s.videoInfo.episodes_names;if(d){const o=[];for(let c=a;c<=t;c++){const p=n-1-c;p>=0&&p<n&&o.push({name:l[p],displayIndex:c,actualIndex:p})}return o}else return l.slice(a,t+1).map((o,c)=>({name:o,displayIndex:a+c,actualIndex:a+c}))},[x,s?.videoInfo?.episodes_names,d]);r.useEffect(()=>{(async()=>{if(!(!h||!f)){w(!0);try{const t=b.find(l=>l.id===h);if(!t)throw new Error("未找到对应的API配置");const n=await Q.getVideoDetail(f,t);D(n)}catch(t){console.error("获取视频详情失败:",t)}finally{w(!1)}}})()},[h,f,b]),r.useEffect(()=>{y.length!==0&&I(y[0].value)},[y,d]);const H=a=>{const t=d?(s?.videoInfo?.episodes_names?.length||0)-1-a:a;A(`/video/${h}/${f}/${t}`)},K=a=>{const t=setTimeout(()=>{N(a)},500);return()=>clearTimeout(t)},J=()=>{_!==null&&setTimeout(()=>{N(null)},300)};return L?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(U,{size:"lg",label:"加载中..."})}):!s||s.code!==200?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"获取视频详情失败"})}):e.jsxs("div",{className:"container mx-auto overflow-x-hidden p-4 pb-15 md:pt-10",children:[e.jsxs(i.div,{className:"flex gap-5",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(i.img,{src:E(),alt:m(),className:"hidden w-70 rounded-lg shadow-lg md:block",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1}}),e.jsxs(i.div,{className:"flex flex-1 flex-col gap-3 rounded-lg bg-white/40 p-4 shadow-lg/5 backdrop-blur-md",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"flex h-auto w-full flex-row justify-center gap-4",children:[e.jsx(i.img,{src:E(),alt:m(),className:"h-full w-1 flex-1/2 rounded-lg object-cover shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.25}}),e.jsxs(i.div,{className:"flex flex-1/2 flex-col gap-1 self-end",initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.3},children:[m()&&e.jsx("h1",{className:"text-[1rem] font-bold sm:text-2xl",children:e.jsx("span",{className:"line-clamp-2 text-gray-800",children:m()})}),e.jsxs("div",{className:"text-[0.7rem] sm:text-[1rem]",children:[g()&&e.jsxs("div",{className:"text-gray-500",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"导演："}),e.jsx("span",{className:"line-clamp-2",children:g()})]}),v()&&e.jsxs("div",{className:"text-gray-500",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"演员："}),e.jsx("span",{className:"line-clamp-2",children:v()})]})]}),e.jsx(i.div,{className:"flex-row flex-wrap text-[0.4rem]",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.4},children:[{color:"primary",value:T()},{color:"secondary",value:S()},{color:"warning",value:P()},{color:"danger",value:$()}].map((a,t)=>e.jsx(i.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.2,delay:.4+t*.05},style:{display:"inline-block"},children:e.jsx(k,{size:"sm",color:a.color,variant:"shadow",className:"mr-1 mb-1",children:a.value})},t))})]})]}),e.jsx("div",{children:j()&&e.jsx(i.div,{className:"mt-3 line-clamp-5 text-[0.8rem] text-gray-600 sm:text-[1rem]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.5},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:j()}})})})]}),m()&&e.jsx(i.h1,{className:"hidden text-3xl font-bold md:block",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},children:e.jsx("span",{className:"text-gray-800",children:m()})}),e.jsx(i.div,{className:"hidden flex-wrap gap-x-1 gap-y-2 md:flex",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.4},children:[{color:"primary",value:T(),delay:0},{color:"secondary",value:S(),delay:.05},{color:"warning",value:P(),delay:.1},{color:"danger",value:$(),delay:.15}].map((a,t)=>e.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.4+a.delay},children:e.jsx(k,{color:a.color,variant:"shadow",className:"mr-2",children:a.value})},t))}),e.jsxs(i.div,{className:"mt-1 hidden flex-col gap-2 pl-1 md:flex",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},children:[g()&&e.jsxs(i.div,{className:"text-gray-600",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"导演："}),e.jsx("span",{children:g()})]}),v()&&e.jsxs(i.div,{className:"text-gray-600",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.65},children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"演员："}),e.jsx("span",{children:v()})]}),j()&&e.jsx(i.div,{className:"mt-3 text-gray-600",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.7},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:j()}})})]})]})]}),s?.videoInfo?.episodes_names&&s.videoInfo.episodes_names.length>0&&e.jsxs(i.div,{className:"mt-8 flex flex-col",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:[e.jsxs(i.div,{className:"flex flex-col gap-2 p-3 pr-0 pl-1",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.4},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex flex-row items-end gap-2",children:e.jsx(i.h2,{className:"text-2xl font-semibold text-gray-900",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.45},children:"选集"})}),e.jsx("div",{className:"flex items-end",children:y.length>1&&e.jsx(V,{size:"sm",selectedKeys:[x],onChange:a=>I(a.target.value),className:"w-35",classNames:{trigger:"bg-white/30 backdrop-blur-md border border-gray-200",value:"text-gray-800 font-medium",popoverContent:"bg-white/40 backdrop-blur-2xl border border-gray-200/50"},"aria-label":"选择集数范围",placeholder:"选择集数范围",children:y.map(a=>e.jsx(W,{children:a.label},a.value))})})]}),e.jsx(Y,{})]}),e.jsx(i.div,{className:"grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-6 lg:grid-cols-8",children:O.map(({name:a,displayIndex:t},n)=>e.jsx(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:n*.03,ease:"easeOut"},children:e.jsx(q,{content:a,placement:"top",delay:1e3,isOpen:_===t,onOpenChange:l=>{l||N(null)},children:e.jsx(z,{size:"md",color:"default",variant:"shadow",className:"w-full border border-gray-200 bg-white/30 text-gray-800 drop-shadow-2xl backdrop-blur-md transition-all duration-300 hover:scale-105 hover:bg-black/80 hover:text-white",onPress:()=>H(t),onPressStart:()=>K(t),onPressEnd:J,children:e.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:a})})})},`${a}-${t}`))},x),e.jsxs(i.div,{className:"mt-4 flex items-end justify-between pr-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.4},children:[e.jsx(i.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(z,{size:"sm",variant:"light",onPress:()=>M(!d),startContent:d?e.jsx(ee,{size:18}):e.jsx(ae,{size:18}),className:"min-w-unit-16 text-sm text-gray-600",children:d?"正序":"倒序"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:["共 ",s.videoInfo.episodes_names.length," 集"]})]})]})]})}export{le as default};
